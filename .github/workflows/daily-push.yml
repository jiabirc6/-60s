name: Daily WeChat Image Push

on:
  schedule:
    - cron: '0 0 * * *'  # 北京时间每天 08:00（你已改的）
  workflow_dispatch:  # 手动测试

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - name: Download Image（验证图片生成）
        run: |
          curl -L -f "https://60s.190009.xyz/v2/60s?encoding=image" -o daily_news.png
          echo "图片下载成功，大小 $(du -h daily_news.png | cut -f1)"

      - name: ServerChan 私聊推送
        run: |
          curl "https://sctapi.ftqq.com/${{ secrets.SCKEY }}.send" \
            -H "Content-Type: application/json" \
            -d "{\"title\":\"今日 60s 新闻摘要\",\"desp\":\"每天 60 秒看世界！<br><img src='https://60s.190009.xyz/v2/60s?encoding=image' width='100%'>\"}"
          echo "✅ ServerChan 推送完成！"

      # 可选：失败通知（用同一个 SCKEY）
      - name: Notify on Failure
        if: failure()
        run: |
          curl "https://sctapi.ftqq.com/${{ secrets.SCKEY }}.send" \
            -H "Content-Type: application/json" \
            -d "{\"title\":\"60s 推送失败\",\"desp\":\"今天生成或推送出问题了，快去 GitHub Actions 看看～\"}"
