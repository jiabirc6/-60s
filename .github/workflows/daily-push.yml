name: Daily WeChat Image Push

on:
  schedule:
    - cron: '0 0 * * *'    # 北京时间每天早上 8:00
  workflow_dispatch:

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - name: 下载今日 60s 图片
        run: |
          curl -L -f "https://60s.190009.xyz/v2/60s?encoding=image" -o 60s.png

      - name: 推送至微信私聊（文件传输助手）
        env:
          TOKEN: ${{ secrets.PPTOKEN }}
        run: |
          # 把图片转成 base64
          BASE64=$(base64 -w 0 60s.png)
          # 直接发到文件传输助手（channel=wechat）
          curl -X POST https://www.pushplus.plus/send \
            -H "Content-Type: application/json" \
            -d "{
              \"token\": \"$TOKEN\",
              \"title\": \"今日 60s 新闻摘要\",
              \"content\": \"<img src='data:image/png;base64,$BASE64' width='100%' />\",
              \"template\": \"html\",
              \"channel\": \"wechat\"
            }"
          echo "已发送至文件传输助手"
