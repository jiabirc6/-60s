name: Daily WeChat Image Push

on:
  schedule:
    # 北京时间 07:00 触发，基本保证 08:00 前一定送达
    - cron: '00 23 * * *'
  workflow_dispatch:  # 手动触发用的

jobs:
  push:
    runs-on: ubuntu-latest
    steps:
      - name: Download Image
        run: |
          curl -L -f "https://60s.190009.xyz/2025encoding-image" -o daily_news.png
          echo "图片下载成功，大小 $(du -h daily_news.png | cut -f1)"

      - name: Push to WeChat via PushPlus
        run: |
          curl -X POST "https://www.pushplus.plus/send/" \
          -H "Content-Type: application/json" \
          -d '{
            "token":"${{ secrets.PPTOKEN }}",
            "title":"今日 60s 新闻速览",
            "content":"<img src=\"https://60s.190009.xyz/2025encoding-image width=\"1000\"/>",
            "template":"html"
          }'
          echo "推送完成！"

      - name: Notify on Failure
        if: failure()
        run: |
          curl -X POST "https://www.pushplus.plus/send/" \
          -d token=${{ secrets.PPTOKEN }} \
          -d title=605 推送失败 \
          -d content="今天脚本跑崩了，快去看看~"
